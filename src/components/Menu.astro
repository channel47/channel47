---
// src/components/Menu.astro
// Full-screen menu overlay with giant ASCII text links
---

<nav class="menu" id="menu" aria-hidden="true">
  <div class="menu__backdrop"></div>

  <div class="menu__content">
    <ul class="menu__list">
      <li class="menu__item" style="--delay: 0">
        <a href="/blog" class="menu__link" data-text="STORIES">
          <span class="menu__ascii">
╔═╗╔╦╗╔═╗╦═╗╦╔═╗╔═╗
╚═╗ ║ ║ ║╠╦╝║║╣ ╚═╗
╚═╝ ╩ ╚═╝╩╚═╩╚═╝╚═╝</span>
          <span class="menu__label">STORIES</span>
        </a>
      </li>
    </ul>

    <div class="menu__footer">
      <span class="menu__hint">ESC to close</span>
    </div>
  </div>
</nav>

<style>
  .menu {
    position: fixed;
    inset: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    opacity: 0;
    visibility: hidden;
  }

  .menu[aria-hidden="false"] {
    pointer-events: auto;
    opacity: 1;
    visibility: visible;
  }

  .menu__backdrop {
    position: absolute;
    inset: 0;
    background: var(--color-void);
    opacity: 0;
    transition: opacity var(--duration-slow) var(--ease-out);
  }

  .menu[aria-hidden="false"] .menu__backdrop {
    opacity: 0.98;
  }

  .menu__content {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    min-height: 100dvh;
    padding: var(--space-8);
    width: 100%;
  }

  .menu__list {
    list-style: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-12);
  }

  .menu__item {
    opacity: 0;
    transform: translateY(20px);
    transition:
      opacity var(--duration-slow) var(--ease-out),
      transform var(--duration-slow) var(--ease-out);
    transition-delay: calc(var(--delay) * 80ms);
  }

  .menu[aria-hidden="false"] .menu__item {
    opacity: 1;
    transform: translateY(0);
  }

  .menu__link {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
    text-decoration: none;
    color: var(--color-text-secondary);
    transition: color var(--duration-fast) var(--ease-out);
  }

  .menu__link:hover,
  .menu__link:focus-visible {
    color: var(--color-accent);
  }

  .menu__ascii {
    font-family: var(--font-mono);
    font-size: clamp(0.5rem, 2.5vw, 1rem);
    line-height: 1.1;
    letter-spacing: 0.05em;
    white-space: pre;
    transition:
      text-shadow var(--duration-normal) var(--ease-out),
      transform var(--duration-normal) var(--ease-out);
  }

  .menu__link:hover .menu__ascii,
  .menu__link:focus-visible .menu__ascii {
    text-shadow: var(--glow-md);
    transform: scale(1.02);
  }

  .menu__label {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    letter-spacing: var(--tracking-widest);
    text-transform: uppercase;
    color: var(--color-text-muted);
    opacity: 0;
    transform: translateY(-5px);
    transition:
      opacity var(--duration-fast) var(--ease-out),
      transform var(--duration-fast) var(--ease-out);
  }

  .menu__link:hover .menu__label,
  .menu__link:focus-visible .menu__label {
    opacity: 1;
    transform: translateY(0);
  }

  .menu__footer {
    position: absolute;
    bottom: var(--space-8);
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity var(--duration-slow) var(--ease-out);
    transition-delay: 300ms;
  }

  .menu[aria-hidden="false"] .menu__footer {
    opacity: 1;
  }

  .menu__hint {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    letter-spacing: var(--tracking-wide);
  }

  /* Mobile adjustments */
  @media (max-width: 640px) {
    .menu__list {
      gap: var(--space-8);
    }

    .menu__ascii {
      font-size: clamp(0.4rem, 4vw, 0.7rem);
    }
  }
</style>

<script>
  const menu = document.getElementById('menu');

  function openMenu() {
    menu?.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  }

  function closeMenu() {
    menu?.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  }

  // Expose functions globally
  (window as any).openMenu = openMenu;
  (window as any).closeMenu = closeMenu;

  // Close on ESC
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && menu?.getAttribute('aria-hidden') === 'false') {
      closeMenu();
    }
  });

  // Close when clicking backdrop
  menu?.querySelector('.menu__backdrop')?.addEventListener('click', closeMenu);

  // Close after clicking a link (with small delay for transition)
  menu?.querySelectorAll('.menu__link').forEach(link => {
    link.addEventListener('click', () => {
      setTimeout(closeMenu, 100);
    });
  });
</script>
