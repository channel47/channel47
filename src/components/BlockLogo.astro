---
interface Props {
  variant?: 'short' | 'long';
  size?: 'small' | 'medium' | 'large';
  class?: string;
  href?: string;
}

const {
  variant = 'short',
  size = 'medium',
  class: className = '',
  href
} = Astro.props;

// Use fs to read files during build time instead of fetch
import { readFile } from 'node:fs/promises';
import path from 'node:path';

// Read the appropriate ASCII art file
const asciiFiles = {
  short: 'ascii/ch47-short.txt',
  long: 'ascii/channel47-long.txt'
};

const filePath = asciiFiles[variant];
let asciiArt = '';

try {
  // Construct path relative to project root
  const fullPath = path.join(process.cwd(), 'public', filePath);
  asciiArt = await readFile(fullPath, 'utf-8');
} catch (error) {
  console.error(`Failed to load ASCII art from ${filePath}:`, error);
  asciiArt = 'CH47'; // Fallback
}

const ariaLabel = variant === 'short' ? 'Channel 47' : 'Channel 47 - Full Logo';
---

{href ? (
  <a href={href} class={`block-logo-link js-logo-trigger ${className}`} aria-label={ariaLabel}>
    <pre class={`block-logo block-logo--${size}`} aria-hidden="true">{asciiArt}</pre>
  </a>
) : (
  <pre class={`block-logo block-logo--${size} ${className}`} role="img" aria-label={ariaLabel}>{asciiArt}</pre>
)}

<script>
  // Add global distortion effect on hover
  const triggers = document.querySelectorAll('.js-logo-trigger');
  const body = document.body;

  triggers.forEach(trigger => {
    const activate = () => body.classList.add('distortion-active');
    const deactivate = () => body.classList.remove('distortion-active');

    // Mouse
    trigger.addEventListener('mouseenter', activate);
    trigger.addEventListener('mouseleave', deactivate);
    
    // Keyboard
    trigger.addEventListener('focus', activate);
    trigger.addEventListener('blur', deactivate);
  });
</script>
