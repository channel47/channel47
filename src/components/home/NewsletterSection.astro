---
// src/components/home/NewsletterSection.astro
import ScrollReveal from '../shared/ScrollReveal.astro';
---

<section class="newsletter-section">
  <div class="newsletter-section__container">
    <div class="newsletter-section__signal-meter">
      <div class="signal-bar active"></div>
      <div class="signal-bar active"></div>
      <div class="signal-bar active"></div>
      <div class="signal-bar active"></div>
      <div class="signal-bar active"></div>
    </div>

    <ScrollReveal direction="up">
      <h2 class="newsletter-section__headline">
        <span class="text-muted">Most of it is noise.</span><br>
        <span class="text-white">I curate the signal.</span>
      </h2>
    </ScrollReveal>

    <div class="newsletter-section__grid">
      <div class="newsletter-section__content">
        <ScrollReveal direction="up" delay={1}>
          <p class="newsletter-section__copy">
            The Claude ecosystem is exploding. New plugins. MCP servers. Workflow breakthroughs. 
            I filter the chaos and send you only the tools that actually matter.
          </p>
        </ScrollReveal>
      </div>

      <div class="newsletter-section__form-wrapper">
        <ScrollReveal direction="up" delay={2}>
          <form class="newsletter-section__form" id="newsletter-form">
            <div class="input-wrapper">
              <input
                type="email"
                name="email"
                placeholder="ENTER YOUR EMAIL"
                class="newsletter-input"
                required
                aria-label="Email address"
              />
              <button type="submit" class="newsletter-button">
                JOIN_SIGNAL
              </button>
            </div>
            <p class="newsletter-disclaimer">
              Weekly. High signal. No spam. Unsubscribe anytime.
            </p>
          </form>

          <div class="newsletter-success" id="newsletter-success" hidden>
            <div class="success-icon">âœ“</div>
            <h3>SIGNAL ACQUIRED</h3>
            <p>Check your inbox to confirm.</p>
          </div>
        </ScrollReveal>
      </div>
    </div>
  </div>
</section>

<style>
  .newsletter-section {
    min-height: 80vh;
    background: #05070a;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-2xl) var(--site-padding-x);
    border-top: 1px solid var(--color-gray-800);
    position: relative;
  }

  .newsletter-section__container {
    max-width: 1200px;
    width: 100%;
    position: relative;
  }

  /* Signal Meter Animation */
  .newsletter-section__signal-meter {
    display: flex;
    gap: 4px;
    margin-bottom: var(--space-xl);
    justify-content: center; /* Centered initially */
  }

  .signal-bar {
    width: 12px;
    height: 40px;
    background: var(--color-gray-800);
    transform: skewX(-20deg);
  }

  .signal-bar.active {
    background: var(--color-accent-primary);
    box-shadow: 0 0 10px rgba(0, 255, 159, 0.5);
    animation: signal-pulse 2s infinite alternate;
  }

  .signal-bar:nth-child(1) { height: 20px; animation-delay: 0s; }
  .signal-bar:nth-child(2) { height: 30px; animation-delay: 0.1s; }
  .signal-bar:nth-child(3) { height: 40px; animation-delay: 0.2s; }
  .signal-bar:nth-child(4) { height: 50px; animation-delay: 0.3s; }
  .signal-bar:nth-child(5) { height: 60px; animation-delay: 0.4s; }

  @keyframes signal-pulse {
    0% { opacity: 0.5; }
    100% { opacity: 1; }
  }

  .newsletter-section__headline {
    font-size: clamp(3rem, 7vw, 6rem);
    font-weight: var(--weight-black);
    line-height: 0.9;
    text-transform: uppercase;
    margin-bottom: var(--space-2xl);
    text-align: center; /* Centered */
  }

  .text-muted { color: var(--color-gray-600); }
  .text-white { color: var(--color-terminal-white); }

  .newsletter-section__grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-2xl);
    align-items: center;
  }

  .newsletter-section__copy {
    font-size: clamp(1.25rem, 2vw, 1.75rem);
    color: var(--color-gray-400);
    line-height: 1.4;
    max-width: 90%;
  }

  .newsletter-section__form {
    width: 100%;
  }

  .input-wrapper {
    display: flex;
    border-bottom: 2px solid var(--color-terminal-white);
    transition: border-color 0.3s ease;
  }

  .input-wrapper:focus-within {
    border-color: var(--color-accent-primary);
  }

  .newsletter-input {
    flex: 1;
    background: transparent;
    border: none;
    padding: var(--space-md) 0;
    font-family: var(--font-mono);
    font-size: 1.25rem;
    color: var(--color-terminal-white);
    outline: none;
  }

  .newsletter-input::placeholder {
    color: var(--color-gray-700);
  }

  .newsletter-button {
    background: transparent;
    border: none;
    color: var(--color-accent-primary);
    font-family: var(--font-mono);
    font-weight: bold;
    font-size: 1.25rem;
    cursor: pointer;
    padding: 0 var(--space-md);
    transition: all 0.3s ease;
  }

  .newsletter-button:hover {
    background: var(--color-accent-primary);
    color: var(--color-terminal-black);
  }

  .newsletter-disclaimer {
    margin-top: var(--space-md);
    font-family: var(--font-mono);
    font-size: 0.875rem;
    color: var(--color-gray-600);
  }

  .newsletter-success {
    text-align: center;
    padding: var(--space-xl);
    border: 1px solid var(--color-accent-primary);
    background: rgba(0, 255, 159, 0.05);
  }

  .success-icon {
    font-size: 4rem;
    color: var(--color-accent-primary);
    margin-bottom: var(--space-md);
  }

  .newsletter-success h3 {
    color: var(--color-terminal-white);
    font-size: 2rem;
    margin-bottom: var(--space-sm);
  }

  .newsletter-success p {
    color: var(--color-gray-400);
    font-family: var(--font-mono);
  }

  @media (max-width: 768px) {
    .newsletter-section__grid {
      grid-template-columns: 1fr;
      text-align: center;
    }
    
    .newsletter-section__copy {
      max-width: 100%;
      margin-bottom: var(--space-xl);
    }

    .input-wrapper {
        flex-direction: column;
        border-bottom: none;
        gap: var(--space-md);
    }
    
    .newsletter-input {
        border-bottom: 2px solid var(--color-gray-600);
        text-align: center;
    }

    .newsletter-button {
        border: 2px solid var(--color-accent-primary);
        padding: var(--space-md);
    }
  }
</style>

<script>
  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const successDiv = document.getElementById('newsletter-success') as HTMLDivElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const email = formData.get('email') as string;

    try {
      // Simulate API call
      const button = form.querySelector('button');
      if (button) {
          const originalText = button.innerText;
          button.innerText = 'INITIALIZING...';
          await new Promise(resolve => setTimeout(resolve, 1500));
          button.innerText = originalText;
      }

      form.style.display = 'none';
      successDiv.hidden = false;
      
      console.log('Signal acquired:', email);
    } catch (error) {
      console.error('Signal lost:', error);
      alert('Connection failed. Retry sequence initiated.');
    }
  });
</script>
